<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=320">
        <link rel="stylesheet" media="screen, print" href="../styles/reset-min.css">
        <link rel="stylesheet" media="screen, print" href="../styles/fonts-min.css">
        <link rel="stylesheet" media="screen and (min-device-width: 481px), print" href="../styles/cg.css">
        <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="../styles/iphone.css">
        <link rel="stylesheet" media="screen, print" href="../styles/syntax.css">
        <!--[if IE]><link rel="stylesheet" media="screen, projection" href="../styles/cg.css"><![endif]-->
        <!--[if lte IE 8]><script src="../scripts/create-elements.js" type="text/javascript"></script><![endif]-->
        <script type="text/javascript" src="../scripts/highlight.pack.js"></script>
        <script type="text/javascript">hljs.initHighlightingOnLoad('html','css','ruby','bash');</script>
        <title>Technical Information #3 - tomohiro.github.com</title>
    </head>
    <body>
        <header>
          <h1><a href="http://tomohiro.github.com">tomohiro.github.com</a></h1>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">Index</a></li>
            </ul>
        </nav>

        <section>
            <article>

<!-- Auto generated start -->

<h1>Technical Information #3</h1>

<h2>Sinatra アプリケーションを Heroku にデプロイする</h2>

<h3>First</h3>

<p><a href="http://heroku.com/">Heroku</a> とは Ruby 版 PaaS サービスのことである．
一般的には Ruby on Rails をデプロイできるサーバとして有名なようだが，Rack ベースの
Web アプリケーションの動作もサポートしている．</p>

<p>そこで今回は Sinatra のアプリケーションを Heroku にデプロイする．</p>

<p>基本的に Heroku の <a href="http://docs.heroku.com/quickstart">Quickstart Guide</a> を参考に
進めて行く．</p>

<h3>Install</h3>

<ol>
<li><p>Heroku にアカウントを登録する</p>

<ol>
<li><a href="http://heroku.com/signup">Create a Heroku Account</a> へアクセスする．</li>
<li>メールアドレスを入力すると <em>Confirmation email sent. Check your inbox</em> と表示
されるのでメールボックスをチェックし Confirmation メール本文中のリンクへアクセスする．</li>
<li>パスワードを登録してアカウント登録は完了．</li>
</ol>
</li>
<li><p>RubyGems で heroku をインストール</p>

<pre><code>$ sudo gem install heroku
</code></pre>

<p> 依存関係でいろいろインストールされます．</p>

<pre><code>Successfully installed mime-types-1.16
Successfully installed rest-client-1.4.2
Successfully installed configuration-1.1.0
Successfully installed launchy-0.3.5
Successfully installed heroku-1.9.9
5 gems installed
Installing ri documentation for mime-types-1.16...
Installing ri documentation for rest-client-1.4.2...
Installing ri documentation for configuration-1.1.0...
Installing ri documentation for launchy-0.3.5...
Installing ri documentation for heroku-1.9.9...
Updating ri class cache with 3576 classes...
Installing RDoc documentation for mime-types-1.16...
Installing RDoc documentation for rest-client-1.4.2...
Installing RDoc documentation for configuration-1.1.0...
Installing RDoc documentation for launchy-0.3.5...
Installing RDoc documentation for heroku-1.9.9...
</code></pre></li>
</ol>


<h3>Deployment</h3>

<p>GitHub でアプリケーションのソースコードを管理しつつ Heroku にデプロイすることを目指す</p>

<ol>
<li><p>Sinatra アプリケーションを用意する</p>

<ol>
<li>GitHub に新しいリポジトリ <code>heroku-example</code> を作成する．</li>
<li><p>ローカルにアプリケーションディレクトリを作成し GitHub に登録する．</p>

<pre><code>$ mkdir heroku-example
$ cd heroku-example
$ git init
$ touch README
$ git add README
$ git commit -m 'first commit'
$ git remote add origin git@github.com:Tomohiro/heroku-example.git
$ git push origin master
</code></pre></li>
<li><p>Sinatra アプリケーションを開発して GitHub にプッシュしておく．</p>

<p> 単純に Heroku へのデプロイメントを試したい場合は Sinatra の Heroku 用
 <a href="http://github.com/sinatra/heroku-sinatra-app">サンプルアプリケーション</a> をチェックアウトして登録してみても良いだろう．</p>

<pre><code>$ vi app.rb
</code></pre>

<blockquote><pre><code>require 'sinatra'
get '/' do
 'Fuck, World!'
end
</code></pre></blockquote>

<pre><code>$ vi config.ru
</code></pre>

<blockquote><pre><code>require 'app'
run Sinatra::Application
</code></pre></blockquote>

<pre><code>$ git add app.rb config.ru
$ git commit
$ git push origin master
</code></pre></li>
</ol>
</li>
<li><p>Heroku にアップロード</p>

<ol>
<li><p>Heroku 上にアプリケーションを作成する．</p>

<pre><code>$ heroku create [optional-app-name]
</code></pre>

<p> <code>heroku create</code> すると Email/Passowrd を聞かれるのであらかじめ Heroku に
 登録したアカウントの情報を入力する．</p>

<pre><code>Enter your Heroku credentials.
Email: tomohiro.t@gmail.com
Password: 
Uploading ssh public key /Users/Tomohiro/.ssh/id_rsa.pub
Creating freezing-samurai-98.... done
Created http://freezing-samurai-98.heroku.com/ | git@heroku.com:freezing-samurai-98.git
Git remote heroku added
</code></pre></li>
<li><p>アプリケーション名をリネームする</p>

<p> <code>heroku create</code> する際アプリケーション名を指定しなかった場合は自動で freezing-samurai-98 といった
 アプリケーション名がつくようになる．変更したい場合は<a href="http://api.heroku.com/myapps">My Apps</a> に
 アクセスしてアプリケーションの<em>General Info</em> から名前を変更する．
 アプリケーション名を変更しない場合は本項を飛ばしてもらって構わない．</p>

<p> <a href="http://docs.heroku.com/renaming-apps#manually-updating-a-git-remote" title="Heroku | Renaming apps">Heroku | Renaming apps</a></p>

<pre><code>$ git remote rm heroku
$ git remote add heroku git@heroku.com:newname.git
</code></pre></li>
<li><p>Heroku にアプリケーションを push する</p>

<pre><code>$ git push heroku master
</code></pre>

<p> 登録に成功すると下記のように出力される．</p>

<pre><code>Counting objects: 15, done.
Delta compression using up to 2 threads.
Compressing objects: 100% (12/12), done.
Writing objects: 100% (15/15), 2.81 KiB, done.
Total 15 (delta 1), reused 0 (delta 0)

-----&gt; Heroku receiving push
-----&gt; Sinatra app detected
       Compiled slug size is 4K
-----&gt; Launching...... done
       http://twitter-okinawa.heroku.com deployed to Heroku

To git@heroku.com:twitter-okinawa.git
 * [new branch]      master -&gt; master
</code></pre></li>
<li><p>登録したアプリケーションを開く</p>

<pre><code>$ heroku open
</code></pre></li>
</ol>
</li>
</ol>


<h3>References</h3>

<ul>
<li><a href="http://heroku.com" title="Heroku">Heroku</a></li>
<li><a href="http://docs.heroku.com/quickstart" title="Heroku | Heroku Quickstart Guide">Heroku | Heroku Quickstart Guide</a></li>
<li><a href="http://docs.heroku.com/rack" title="Heroku | Deploying Rack-based Apps">Heroku | Deploying Rack-based Apps</a></li>
<li><a href="http://www.sinatrarb.com" title="Sinatra">Sinatra</a></li>
<li><a href="http://www.sinatrarb.com/intro-jp.html" title="Sinatra: README (Japanese)">Sinatra: README (Japanese)</a></li>
</ul>


<div><script>
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
        if(links[i].href.indexOf('#disqus_thread') >= 0) {
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
        }
    }
    document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/tomohiro-github-com/get_num_replies.js' + query + '"></' + 'script>');
})();
</script>
<section id="disqus_thread"></section>
<script type="text/javascript">
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://tomohiro-github-com.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=tomohiro-github-com">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>



<!-- Auto generated end -->

            </article>
        </section>

        <footer>
            <p>Copyright &#169; 2010 <a href="mailto:tomohiro.t@gmail.com">Tomohiro</a> All rights reserved.</p>
            <p>Powered by <a href="http://rubygems.org/gems/cg" title="cg - A Ruby based contents generator">cg - A Ruby based contents generator</a></p>
        </footer>
    </body>
</html>
