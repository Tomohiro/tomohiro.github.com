<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="ja" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link rel="stylesheet" type="text/css" href="style.css" />
<title>git勉強会</title>
</head>
<body>
<a href="#doc_content">目次</a>
<hr />
<h1><a class="anchor" id="anchor0" name="anchor0"> git勉強会</a></h1>

<hr />
<h2><a class="anchor" id="anchor1" name="anchor1"> 導入編</a></h2>

<h3><a class="anchor" id="anchor2" name="anchor2"> バージョン管理システム</a></h3>

<p>
git はバージョン管理システムの 1 つ。
</p>
<p>
バージョン管理システムは、プログラムのソースファイルやテキストファイルの変更履歴 (バージョン/リビジョン) を管理します。
</p>
<p>
あるファイルをバージョン管理に頼らずに管理しようとした場合、変更前にファイルのバックアップを作ってから、ファイルを変更するでしょう。何らかの手違いがあって、ファイルを元に戻したいとき、予め作成しておいたバックアップファイルをコピーすることで元へ戻すでしょう。
</p>
<pre><code>hello.rb を変更しようと思ったら

 % cat hello.rb
 #!/usr/bin/env ruby
 puts 'hello'

変更の前にファイルのバックアップを作成してから

 % cp hello.rb hello.rb.bak

変更を始めると安心です 

 % vi hello.rb

hello.rb を壊してしまっても元に戻せます

 % cp hello.rb.bak hello.rb

もし hello.rb を壊してしまい hello.rb.bak を作成し忘れていたら! 恐いですね</code></pre>

<p>
この辺、バージョン管理システムを使うと、バージョン管理システムが指示通りよしなに計らってくれますので、プログラム修正が楽になり、かつ安心してぶっ壊すことができます。
</p>
<pre><code>例えば git を使っていたなら hello.rb をぶっ壊しても

% git checkout -- hello.rb

これだけで元通り!</code></pre>

<p>
バージョン管理システムの利点は他にも
</p>
<ul>
<li>
ファイルを過去のバージョンへ戻したり
</li>
<li>
過去の状態からどのように変更されてきたのかを閲覧できたり
</li>
<li>
他者と共同してファイルを変更できたり
</li>
</ul>

<p>
オープンソースとして開発/公開されている、様々なバージョン管理システムを、ほどんどの OS で利用可能です。
</p>
<ul>
<li>
CVS
</li>
<li>
Subversion
</li>
<li>
Git
</li>
</ul>

<p>
今回、この中から Git を学びます。理由は
</p>
<ul>
<li>
CVS, Subversion の機能を踏襲しつつ
</li>
<li>
分散リポジトリという考えが実装されており、より他者と共同して作業し易い
</li>
<li>
Linux kernel の開発にも使われているという実績(その他いっぱい)から、信頼性は折り紙付き
</li>
<li>
github という、より気軽に使えるホスティングサービスあり
</li>
</ul>

<p>
皆様の作ったプログラムは github で公開することになるでしょう。
</p>
<h3><a class="anchor" id="anchor3" name="anchor3"> リポジトリって?(イメージ)</a></h3>

<a href="figures/repository.png">
<img src="figures/repository.png" class="image" />
</a>
<h3><a class="anchor" id="anchor4" name="anchor4"> svn, cvsのバージョン管理(イメージ)</a></h3>

<a href="figures/cvs-subversion.png">
<img src="figures/cvs-subversion.png" class="image" />
</a>
<h3><a class="anchor" id="anchor5" name="anchor5"> git, mercurialのバージョン管理(イメージ)</a></h3>

<a href="figures/git-mercurial.png">
<img src="figures/git-mercurial.png" class="image" />
</a>
<hr />
<h2><a class="anchor" id="anchor6" name="anchor6"> はじめにやること!</a></h2>

<h3><a class="anchor" id="anchor7" name="anchor7"> git config: git の設定</a></h3>

<p>
ユーザ名とメールアドレスを git に教えてあげます。
</p>
<pre><code>$ git config --global user.name &quot;Takumi KINJO&quot;
$ git config --global user.email &quot;kinjo@cr.ie.u-ryukyu.ac.jp&quot;</code></pre>

<p>
次に無視リストを作成しておきましょう。
</p>
<p>
ログファイルや簡単なバックアップファイル、オブジェクトファイルといった類のファイルはバージョン管理下に含めないのが一般的です。
</p>
<pre><code>$ git config --global core.excludesfile &quot;$HOME/.gitignore&quot;
$ vi ~/.gitignore
*.bak
*.log
#*#
*~
*.o
.*.swp</code></pre>
<h3><a class="anchor" id="anchor8" name="anchor8"> 勉強用のリポジトリを作成</a></h3>

<p>
適当なディレクトリを作成し勉強用の仮プロジェクトを始めよう。
</p>
<pre><code>$ mkdir ~/hago
$ cd ~/hago</code></pre>

<p>
あとは簡単、
</p>
<pre><code>$ git init</code></pre>
<hr />
<h2><a class="anchor" id="anchor9" name="anchor9"> ひとりでできるもん編</a></h2>

<h3><a class="anchor" id="anchor10" name="anchor10"> index って?</a></h3>

<p>
cvs, subversion では index ってのをあんま意識しないが、git 勉強してて index を意識しないといけないことが分かった。
</p>
<a href="figures/git-index.png">
<img src="figures/git-index.png" class="image" />
</a>
<h3><a class="anchor" id="anchor11" name="anchor11"> git add: index にファイルを追加</a></h3>

<p>
add はファイルを index へ追加します
</p>
<pre><code>$ vi first.rb # &lt;= 内容なんでもよいよ、適当に作ってくだちい
$ git add first.rb</code></pre>

<p>
cvs や subversion, もしくは mercurial の add とは様相が違う。なんでかというと、ファイルを変更した後も変更したファイルに対して git add せないかん。
</p>
<pre><code>git add は index に対してファイルの追加を行う
commit は index の内容をリポジトリに焼き付ける</code></pre>

<p>
おっと、そう、だからまだリポジトリには登録されてないぞ。commit をせな (commit は後で)。
</p>
<h3><a class="anchor" id="anchor12" name="anchor12"> git status: ワーキングツリー中のファイルの状態</a></h3>

<pre><code>$ vi README # &lt;= 内容は適当にどぞ
$ git status</code></pre>

<p>
first.rb はさっき add したからね。first.rb と、まだ git add していない README とを見比べてみよう。
</p>
<pre><code># On branch master
#
# Initial commit
#
# Changes to be committed:
#   (use &quot;git rm --cached &lt;file&gt;...&quot; to unstage)
#
#       new file:   first.rb
#
# Untracked files:
#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
#
#       README</code></pre>

<p>
git status はREADME はコミットに含まれませんよ。README をコミットしたければ git add してね、とおっしゃっております。
</p>
<p>
では
</p>
<pre><code>$ git add README</code></pre>
<h3><a class="anchor" id="anchor13" name="anchor13"> git help: git サブコマンドのヘルプを見てみよう</a></h3>

<p>
英語がなんだって? 自慢だがセンターの英語の点数は 8(ry
</p>
<pre><code>$ git help add
$ git help status</code></pre>

<p>
git help だと英語ですが、日本語訳がどっかにあるはず。
</p>
<pre><code>どなたか発見してやってください</code></pre>
<h3><a class="anchor" id="anchor14" name="anchor14"> git commit: リポジトリに焼き付ける</a></h3>

<p>
index の内容をリポジトリに焼き付けます。 
</p>
<pre><code>$ git commit -m '最初のコミット'</code></pre>

<p>
実際のプログラム修正では、これでまず一段落。コーヒーでも飲みに行こうか。
</p>
<p>
変更したファイルを commit するとき、その都度 git add するのは面倒なので、
</p>
<pre><code>$ git commit -a -m '...'</code></pre>

<p>
とすることもできますが、ここに落し穴が、
</p>
<pre><code>まだリポジトリに無いファイルについては、初回は git add で登録すること</code></pre>
<h3><a class="anchor" id="anchor15" name="anchor15"> git git log: 記録をみてみよう</a></h3>

<p>
リポジトリに対して誰が何を行ったのか、 git log を実行してチェックできます。
</p>
<pre><code>$ git log</code></pre>
<h3><a class="anchor" id="anchor16" name="anchor16"> git reset: git add を取り消す</a></h3>

<p>
あるファイルを git add したけど取り消したい場合 git reset を使います。やってみよう。
</p>
<pre><code>$ vi TODO
$ git add -A # &lt;= まだ git add していないファイルを全部 add
$ git status
# On branch master
# Changes to be committed:
#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)
#
#       new file:   TODO
#</code></pre>

<p>
ここで、やっぱり TODO の git add を取り消したいとします。
</p>
<pre><code>$ git reset TODO
$ git status
# On branch master
# Untracked files:
#   (use &quot;git add &lt;file&gt;...&quot; to include in what will be committed)
#
#       TODO</code></pre>

<p>
取り消せました。
</p>
<p>
ただし、初回 git commit の前だと git reste で git add を打ち消せない。git rm でファイルごと消すしかない。
</p>
<h3><a class="anchor" id="anchor17" name="anchor17"> git reset HEAD^: git commit を取り消す</a></h3>

<p>
ワーキングツリーで行われた操作を記録することが git を始めとするバージョン管理システムの売りです。
</p>
<pre><code>でも、この操作はそれらの記録を無かったことにします</code></pre>

<p>
消し飛んだ記録は絶対に戻らないので、この操作は多用しない方がいいです。
</p>
<p>
直前のコミットを取り消すには、例えば以下のようにタイプします。
</p>
<pre><code>$ git reset HEAD^</code></pre>

<p>
やってみよう。
</p>
<pre><code>$ vi first.rb # &lt;= 適当に内容をぶちこわし
$ git commit -a -m 'Oops!'
$ git reset HEAD^</code></pre>

<p>
どうですか? ログを確認してみよう。
</p>
<pre><code>$ git log</code></pre>

<p>
ファイルは?
</p>
<pre><code>$ git status</code></pre>

<p>
だた、初回コミットだけは git reset HEAD^ で取り消せないようです。
</p>
<p>
この機能は今のとこ git だけに搭載されている。mercurial も commit 取り消しはできるが、直前の 1 commit しか取り消しできない。
</p>
<p>
subversion で commit の取り消しに近いことはできますが、ログをまるごと消し飛ばしてしまう操作はできないようです。
</p>
<h3><a class="anchor" id="anchor18" name="anchor18"> git checkout: 変更したファイルを元に戻す</a></h3>

<p>
first.rb が壊れたままです。このままではいけないので、
</p>
<pre><code>$ git checkout -- first.rb</code></pre>

<p>
どうやら -- はつけた方がいいみたいです。
</p>
<p>
ワーキングツリー中の全ての変更を破棄するには、以下のようにタイプします。
</p>
<pre><code>$ git checkout -- .</code></pre>
<hr />
<h2><a class="anchor" id="anchor19" name="anchor19"> 分散リポジトリ編</a></h2>

<h3><a class="anchor" id="anchor20" name="anchor20"> 分散リポジトリイメージ</a></h3>

<a href="figures/distributed-repositories.png">
<img src="figures/distributed-repositories.png" class="image" />
</a>
<a href="figures/clone-working-tree.png">
<img src="figures/clone-working-tree.png" class="image" />
</a>
<h3><a class="anchor" id="anchor21" name="anchor21"> git clone: ワーキングツリーをコピる</a></h3>

<p>
ワーキングツリー proj を subproj へコピーします。
</p>
<pre><code>$ cd ..
$ ls
proj/ ...
$ git clone ./proj ./subproj</code></pre>

<p>
これでリポジトリ(= ワーキングツリー) は 2 つに分散されました。
</p>
<p>
./subproj は ./proj からコピーされたことをどこかで覚えているようです。(./subproj/.git のどこかに保存されているのだろうか)
</p>
<h3><a class="anchor" id="anchor22" name="anchor22"> git push: 変更を親ツリーへアップ</a></h3>

<p>
さて、 ./subproj の中で作業を行い、それらの変更を親 proj へ反映してみよう。
</p>
<pre><code>そんなとき git push</code></pre>

<p>
さて使ってみよう。
</p>
<pre><code>$ cd ./subproj
$ vi README # &lt;= 適当にどぞ
$ git commit -a -m '...'
$ git push
$ cd ../proj
$ cat README # &lt;= 変更した内容通りになってますか?</code></pre>

<p>
子ツリーで git push する前に、親ツリーで更新が行われてしまった場合、git push はエラーを表示して失敗するでしょう。
</p>
<p>
例えば、こんな感じで、
</p>
<pre><code>$ vi README
### 最初の行に適当になんか書いて ###
$ git commit -a -m '...'
$ cd ../subproj
$ vi README
### 最初の行に別の何かを適当に書いて ###
$ git commit -a -m '...'
$ git push
To /home/kinjo/workspace/./proj
 ! [rejected]        master -&gt; master (non-fast forward)
error: failed to push some refs to '/home/kinjo/workspace/./proj'
To prevent you from losing history, non-fast-forward updates were rejected
Merge the remote changes before pushing again.  See the 'non-fast forward'
section of 'git push --help' for details.</code></pre>

<p>
このような場合、いったん git pull で変更点をダウンロードしてからgit push を実行します。
</p>
<h3><a class="anchor" id="anchor23" name="anchor23"> git pull: 親ツリーから変更をダウンロード</a></h3>

<p>
基本的には、親の変更をダウンロードするために git pull をします。
</p>
<pre><code>$ cd ../subproj
$ git pull</code></pre>

<p>
なのですが、現在のツリーと親ツリーとで内容が異なる場合、恐怖の衝突 (conflict) が起こります。
</p>
<p>
前の節からの続きであれば、README は多分こんな感じで衝突するでしょう。
</p>
<pre><code>$ cat README
&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD
parent
=======
child
&gt;&gt;&gt;&gt;&gt;&gt;&gt; c0d0845c95b7522f6c146521d805734361d1b007</code></pre>

<p>
親の変更は破棄して、こんな感じに衝突箇所を直してあげましょう。
</p>
<pre><code>$ cat README
child</code></pre>

<p>
衝突箇所を直した後は git commit を忘れずに!
</p>
<pre><code>$ git commit -a -m 'merged'</code></pre>

<p>
これで git pull は完了です。この後であれば git push できるようになります。
</p>
<pre><code>$ git push</code></pre>

<p>
さ、親ワーキングツリーの README はどうなりましたか?
</p>
<pre><code>$ cd ../proj
$ cat README</code></pre>
<hr />
<h2><a class="anchor" id="anchor24" name="anchor24"> branch 編</a></h2>

<h3><a class="anchor" id="anchor25" name="anchor25"> branch イメージ</a></h3>

<p>
subversion と mercurial のブランチは、まるっとコピーするイメージなので、git branch のイメージとは異なるかと思います。
</p>
<a href="figures/branches.png">
<img src="figures/branches.png" class="image" />
</a>
<h3><a class="anchor" id="anchor26" name="anchor26"> git branch &lt;ブランチ名&gt;: ブランチの作成</a></h3>

<p>
さ、 branch を作りましょう。
</p>
<pre><code>$ cd ../proj
$ git branch hago</code></pre>

<p>
hago ブランチが作成されました。
</p>
<h3><a class="anchor" id="anchor27" name="anchor27"> git branch: ブランチの一覧</a></h3>

<p>
git branch とだけタイプするとブランチの一覧が表示されます。
</p>
<pre><code>$ git branch
  hago
* master</code></pre>

<p>
出力から、今私たちが作業していたブランチは master だということが分かります。(アスタリスクでマークされています)
</p>
<p>
master は最初から用意されたデフォルトのブランチです。
</p>
<h3><a class="anchor" id="anchor28" name="anchor28"> git checkout: branch の切り替え</a></h3>

<p>
hago ブランチに切り替えて変更を行ってみよう。
</p>
<p>
まず、 hago ブランチへ切り替え、
</p>
<pre><code>$ git checkout hago
$ git branch
* hago
  master</code></pre>

<p>
hago ブランチへ切り替わりましたので、README, first.rb に変更を加えてみます。git commit も忘れずに!
</p>
<pre><code>$ vi README
$ vi first.rb
$ git commit -a -m 'hago hago'</code></pre>

<p>
ここでまた master ブランチへ戻り、 README, first.rb の内容を確認しましょう。元の内容が維持されていますか?
</p>
<pre><code>$ git checkout master
$ cat README
$ cat first.rb</code></pre>

<p>
ブランチは、いまのバージョンと別なバージョンを作成したいときに使います。(元のソースを維持したまま、ソースを弄くりたい場合に最適)
</p>
<h3><a class="anchor" id="anchor29" name="anchor29"> git merge: branch 間のマージ</a></h3>

<p>
hago ブランチで行った修正を master に取り込みましょう。
</p>
<pre><code>$ git checkout master
$ git merge hago</code></pre>

<p>
もし git merge hago の前に master ブランチで変更があった場合、例によって衝突が発生するケースもあります。
</p>
<p>
そのような場合、先にやった通り、衝突のあったファイルを編集して直してあげる必要があります。(衝突のあったファイルは git status で確認できます)
</p>
<p>
衝突を解決した後は、 git commit を忘れずに!
</p>
<hr />
<h2><a class="anchor" id="anchor30" name="anchor30"> いろいろいろ</a></h2>

<h3><a class="anchor" id="anchor31" name="anchor31"> git にやられたい方はジュンク堂へ参られい</a></h3>

<p>
入門GIT
</p>
<p>
<a href="http://www.amazon.co.jp/入門Git-濱野-純-Junio-Hamano/dp/4798023809/ref=sr_1_1?ie=UTF8&s=books&qid=1259854321&sr=8-1">
http://www.amazon.co.jp/入門Git-濱野-純-Junio-Hamano/dp/4798023809/ref=sr_1_1?ie=UTF8&s=books&qid=1259854321&sr=8-1
</a>
</p>
<hr />
<h2><a class="anchor" id="anchor32" name="anchor32"> では github へ参ろうか</a></h2>

<h1><a class="anchor" id="doc_content" name="doc_content">目次</a></h1>
<ol>
<li>
<a href="#anchor0" class="link">
 git勉強会
</a>
<ol>
<li>
<a href="#anchor1" class="link">
 導入編
</a>
<ol>
<li>
<a href="#anchor2" class="link">
 バージョン管理システム
</a>
</li>
<li>
<a href="#anchor3" class="link">
 リポジトリって?(イメージ)
</a>
</li>
<li>
<a href="#anchor4" class="link">
 svn, cvsのバージョン管理(イメージ)
</a>
</li>
<li>
<a href="#anchor5" class="link">
 git, mercurialのバージョン管理(イメージ)
</a>
</li>
</ol>
</li>
<li>
<a href="#anchor6" class="link">
 はじめにやること!
</a>
<ol>
<li>
<a href="#anchor7" class="link">
 git config: git の設定
</a>
</li>
<li>
<a href="#anchor8" class="link">
 勉強用のリポジトリを作成
</a>
</li>
</ol>
</li>
<li>
<a href="#anchor9" class="link">
 ひとりでできるもん編
</a>
<ol>
<li>
<a href="#anchor10" class="link">
 index って?
</a>
</li>
<li>
<a href="#anchor11" class="link">
 git add: index にファイルを追加
</a>
</li>
<li>
<a href="#anchor12" class="link">
 git status: ワーキングツリー中のファイルの状態
</a>
</li>
<li>
<a href="#anchor13" class="link">
 git help: git サブコマンドのヘルプを見てみよう
</a>
</li>
<li>
<a href="#anchor14" class="link">
 git commit: リポジトリに焼き付ける
</a>
</li>
<li>
<a href="#anchor15" class="link">
 git git log: 記録をみてみよう
</a>
</li>
<li>
<a href="#anchor16" class="link">
 git reset: git add を取り消す
</a>
</li>
<li>
<a href="#anchor17" class="link">
 git reset HEAD^: git commit を取り消す
</a>
</li>
<li>
<a href="#anchor18" class="link">
 git checkout: 変更したファイルを元に戻す
</a>
</li>
</ol>
</li>
<li>
<a href="#anchor19" class="link">
 分散リポジトリ編
</a>
<ol>
<li>
<a href="#anchor20" class="link">
 分散リポジトリイメージ
</a>
</li>
<li>
<a href="#anchor21" class="link">
 git clone: ワーキングツリーをコピる
</a>
</li>
<li>
<a href="#anchor22" class="link">
 git push: 変更を親ツリーへアップ
</a>
</li>
<li>
<a href="#anchor23" class="link">
 git pull: 親ツリーから変更をダウンロード
</a>
</li>
</ol>
</li>
<li>
<a href="#anchor24" class="link">
 branch 編
</a>
<ol>
<li>
<a href="#anchor25" class="link">
 branch イメージ
</a>
</li>
<li>
<a href="#anchor26" class="link">
 git branch &lt;ブランチ名&gt;: ブランチの作成
</a>
</li>
<li>
<a href="#anchor27" class="link">
 git branch: ブランチの一覧
</a>
</li>
<li>
<a href="#anchor28" class="link">
 git checkout: branch の切り替え
</a>
</li>
<li>
<a href="#anchor29" class="link">
 git merge: branch 間のマージ
</a>
</li>
</ol>
</li>
<li>
<a href="#anchor30" class="link">
 いろいろいろ
</a>
<ol>
<li>
<a href="#anchor31" class="link">
 git にやられたい方はジュンク堂へ参られい
</a>
</li>
</ol>
</li>
<li>
<a href="#anchor32" class="link">
 では github へ参ろうか
</a>
</li>
</ol>
</li>
</ol>

</body>
