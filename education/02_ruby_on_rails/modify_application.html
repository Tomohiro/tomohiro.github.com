<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=320">
        <link rel="stylesheet" media="screen, print" href="../../styles/reset-min.css">
        <link rel="stylesheet" media="screen, print" href="../../styles/fonts-min.css">
        <link rel="stylesheet" media="screen and (min-device-width: 481px), print" href="../../styles/cg.css">
        <link rel="stylesheet" media="only screen and (max-device-width: 480px)" href="../../styles/iphone.css">
        <!--[if IE]><link rel="stylesheet" media="screen, projection" href="../../styles/cg.css"><![endif]-->
        <!--[if lte IE 8]><script src="../../scripts/create-elements.js" type="text/javascript"></script><![endif]-->
        <title>Ruby on Rails 基礎 - 琉球大学大学院 情報工学実践IV - tomohiro.github.com</title>
    </head>
    <body>
        <header>
          <h1><a href="http://tomohiro.github.com">tomohiro.github.com</a></h1>
        </header>

        <nav>
            <ul>
                <li><a href="index.html">Index</a></li>
            </ul>
        </nav>

        <article>

<!-- Auto generated start -->

<h1>Ruby on Rails 基礎 - 琉球大学大学院 情報工学実践IV</h1>

<h2>応用 - Web アプリケーション開発</h2>

<h3>目次</h3>

<ol>
<li>はじめに</li>
<li>ジャンルをコンボボックスで登録，一覧画面で参照できるようにする</li>
<li>バリデーション</li>
</ol>


<h3>はじめに</h3>

<p>これまで作成した簡単なアプリケーションを改造して，より Ruby on Rails らしい
開発方法に触れてみよう</p>

<h3>ジャンルをコンボボックスで登録，一覧画面で参照できるようにする</h3>

<p>ジャンルの ID を数値でて入力するのは面倒くさい。そこで，コンボボックスを使って，簡単に登録できるようにしてみよう</p>

<ol>
<li><p>コンボボックスは，HTML の SELECT タグで実現できる</p>

<p> Rails では，SELECT タグを簡単に作成できるヘルパーメソッドが用意されている</p>

<p> 【参考リンク】</p>

<ul>
<li><a href="http://api.rubyonrails.org/classes/ActionView/Helpers/FormOptionsHelper.html">Rails API: select</a></li>
</ul>
</li>
<li><p>Helper を書く</p>

<pre><code> $ vi app/helpers/cds_helper.rb
</code></pre>

<blockquote><pre><code>1 module CdsHelper
2   #
3   # ジャンル一覧を SELECT リスト形式で返す
4   #
5   def genre_list
6     Genre.find(:all).collect { |p| [p.name, p.id] }
7   end
8 end
</code></pre></blockquote></li>
<li><p>新規作成画面を編集</p>

<pre><code> $ vi app/views/cds/new.html.erb
</code></pre>

<blockquote><pre><code># 16行目を書き換える
&lt;%= select("cd", "genre_id", genre_list) %&gt;
</code></pre></blockquote></li>
<li><p>編集画面を編集</p>

<pre><code> $ vi app/views/cds/edit.html.erb
</code></pre>

<blockquote><pre><code># 16行目を書き換える
&lt;%= select("cd", "genre_id", genre_list) %&gt;
</code></pre></blockquote></li>
<li><p>テーブルの関連付けを行う</p>

<p> <em>CD モデルを変更</em></p>

<pre><code> $ vi app/models/cd.rb
</code></pre>

<blockquote><pre><code>1 class Cd &lt; ActiveRecord::Base
2   belongs_to :genre # 関連付けたいモデル genre を定義
3 end
</code></pre></blockquote>

<pre><code>*ジャンルモデルを変更*

    $ vi app/models/genre.rb
</code></pre>

<blockquote><pre><code>1 class Genre &lt; ActiveRecord::Base
2   has_many :cds # 関連付けたいモデル cds を定義(複数形になっているので注意)
3 end
</code></pre></blockquote>

<ol>
<li><p>詳細参照画面を編集</p>

<pre><code> $ vi app/views/cds/show.html.erb
</code></pre>

<blockquote><pre><code> # 13行目を書き換える
 &lt;%=h @cd.genre.name %&gt;
</code></pre></blockquote></li>
<li><p>一覧画面を編集</p>

<pre><code> $ vi app/views/cds/index.html.erb
</code></pre>

<blockquote><pre><code> # 17行目を書き換える
 &lt;td&gt;&lt;%=h cd.genre.name %&gt;&lt;/td&gt;
</code></pre></blockquote></li>
<li><p>Rails のテーブル間の結び付きについて</p></li>
</ol>


<p>【参考リンク】</p>

<ul>
<li><a href="http://wota.jp/ac/?date=20060120">Associations</a></li>
</ul>


<h3>バリデーション</h3>

<p>プログラムでトラブルが起こらないように，入力値のチェック（バリデーション）は必ず行う必要がある</p>

<ol>
<li><p>バリデーションって何？</p>

<p> 正しい結果になるかどうかを検査すること。妥当性検証。</p>

<p> 【参考リンク】</p>

<ul>
<li><a href="http://kotobank.jp/word/%E3%83%90%E3%83%AA%E3%83%87%E3%83%BC%E3%82%B7%E3%83%A7%E3%83%B3">バリデーション</a></li>
</ul>
</li>
<li><p>CD 登録の入力チェックを行う</p>

<pre><code> $ vi app/models/cd.rb
</code></pre>

<blockquote><pre><code>1 class Cd &lt; ActiveRecord::Base
2   belongs_to :genre
3
4   validates_presence_of :artist, :title, :year, :message =&gt; 'は必須入力です。'
5   validates_numericality_of :year, :message =&gt; 'は数字で入力してください'
6 end
</code></pre></blockquote></li>
<li><p>ジャンル登録の入力チェックを行う</p>

<pre><code> $ vi app/models/genre.rb
</code></pre>

<blockquote><pre><code>1 class Genre &lt; ActiveRecord::Base
2   has_many :cds
3
4   validates_presence_of :name, :message =&gt; 'は必須入力です。'
5 end
</code></pre></blockquote></li>
</ol>
</li>
</ol>


<div><script>
(function() {
    var links = document.getElementsByTagName('a');
    var query = '?';
    for(var i = 0; i < links.length; i++) {
        if(links[i].href.indexOf('#disqus_thread') >= 0) {
            query += 'url' + i + '=' + encodeURIComponent(links[i].href) + '&';
        }
    }
    document.write('<script charset="utf-8" type="text/javascript" src="http://disqus.com/forums/tomohiro-github-com/get_num_replies.js' + query + '"></' + 'script>');
})();
</script>
<section id="disqus_thread"></section>
<script type="text/javascript">
  (function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = 'http://tomohiro-github-com.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=tomohiro-github-com">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
</div>



<!-- Auto generated end -->

        </article>

        <footer>
            <p>Copyright &#169; 2010 <a href="mailto:tomohiro.t+github@gmail.com">Tomohiro</a> All rights reserved.</p>
            <p>Powerd by <a href="http://github.com/Tomohiro/cg" title="cg - A Ruby based ContentsGenerator">cg - A Ruby based contents generator</a></p>
        </footer>
    </body>
</html>
