<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="ja" lang="ja">
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <meta http-equiv="Content-Script-Type" content="text/javascript" />
        <meta http-equiv="Content-Style-Type" content="text/css" />
        <meta name="robots" content="nofollow" />
        <link rel="stylesheet" type="text/css" href="styles/default.css" media="screen" />
        <title>Ruby 基礎 - 式</title>
    </head>
    <body>
        <h1>Ruby 基礎 - 式</h1>

        <h2>はじめに</h2>
        <p>ここでは，Ruby の演算子や制御構造について学ぶ。</p>
        <p>また他の言語と大きく異なる，ほとんどすべてのものが式であるという Ruby の特色についての理解を深める。</p>

        <h2>Agenda</h2>
        <ol>
            <li><a href="#operator">演算子式</a></li>
            <li><a href="#assign">代入</a></li>
            <li><a href="#condition">条件式</a></li>
            <li><a href="#loop">ループ</a></li>
            <li><a href="#exercise">演習問題</a></li>
        </ol>

        <hr />

        <ol>
            <li id="operator">
            <h3>演算子式</h3>
            <ol>
                <li>
                <h4>四則演算</h4>
                <p>数値は掛けたり割ったりといった四則演算が可能である。Rubyで利用できる四則演算は次の通り。</p>
                <table>
                    <thead>
                        <tr>
                            <td>演算子</td>
                            <td>内容</td>
                            <td>例</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>*</th>
                            <td>乗算</td>
                            <td>5 * 3</td>
                        </tr>
                        <tr>
                            <th>/</th>
                            <td>除算</td>
                            <td>8 / 2</td>
                        </tr>
                        <tr>
                            <th>+</th>
                            <td>加算</td>
                            <td>3 + 6</td>
                        </tr>
                        <tr>
                            <th>-</th>
                            <td>減算</td>
                            <td>7 - 2</td>
                        </tr>
                    </tbody>
                </table>

                <p>
                四則演算で使われる「*/+-%」は演算子式の一部である。<br/>
                数値に対して四則演算が行われた結果も数値となる（正確には数値オブジェクト）。
                </p>
                <p>では実際に幾つかの演算を行ってみよう。</p>

                <code>$ vi calc.rb</code>
                <pre><code>puts "5 * 3 = #{5*3}"
puts "8 / 2 = #{8/2}"
puts "4 + 6 = #{4+6}"
puts "7 - 2 = #{7-2}"</code></pre>
                <code>$ ruby calc.rb</code>
                </li>

                <li>
                <h4>その他の演算子</h4>
                <p>四則演算以外の演算子について見ていく。</p>
                <table>
                    <thead>
                        <tr>
                            <td>演算子</td>
                            <td>内容</td>
                            <td>例</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>%</th>
                            <td>剰余</td>
                            <td>5 % 3</td>
                        </tr>
                        <tr>
                            <th>**</th>
                            <td>累乗</td>
                            <td>5 ** 2</td>
                        </tr>
                    </tbody>
                </table>

                <p>
                「%」は左側の値を右側の値で割った余りとなる。「5 % 3」であれば5を3で割った余りの「2」が演算結果となる。<br />
                「**」は左側の値を右側の値で累乗した値となる。「5 ** 2」であれば5の二乗となり，「25」が演算結果となる。<br />
                では実際に試してみよう。
                </p>

                <code>$ vi calc.rb</code>
                <pre><code>puts "5 % 2 = #{5%2}"
puts "5 ** 3 = #{5**3}"</code></pre>
                <code>$ ruby calc.rb</code>
                </li>
            </ol>
            </li>

            <li id="assign">
            <h3>代入</h3>
            <p>Ruby には基本的な2つの代入形式がある</p>

            <ol>
                <li>
                <h4>オブジェクトリファレンスを変数または定数に代入すること</h4>
                <pre><code>name = '鈴木'
height = 180
MAIL_DOMAIN = 'occ.co.jp'</code></pre>
                </li>
                <li>
                <h4>左辺にオブジェクト属性・または要素リファレンスが来る場合</h4>
                <pre><code>person.name = '鈴木'
person.height = 180
address["city"] = '浦添'</code></pre>
                </li>
            </ol>
            </li>

            <li>
            <h3 id="condition">条件式</h3>
            <ol>
                <li>
                <h4>if 式</h4>
                <p>
                if 式では比較条件を評価し結果が真であれば文を実行し，真でなければ else で指定した文を実行する。<br />
                他の言語の if 文と良く似ている。<br />
                <em>※ Java や C と違い，else if が elsif であることに注意。</em>
                </p>
                <pre><code>if 条件1 then
  処理1
elsif 条件2 then
  処理2
elsif 条件3 then
  処理3
else
  処理4
end</code></pre>
                <p>コードサンプル</p>
                <code>$ vi if.rb</code>
                <pre><code>company == "OCC"
if company == "Google"
  location = "アメリカの会社"
elsif company == "OCC"
  location = "沖縄の会社"
else
  location = "所在地不明"
end</code></pre>
                <code>$ ruby if.rb</code>
                <p>if 式を同一行に書きたい場合は，条件式の後に then キーワードを用いて続けて書くことができる。</p>
                <pre><code>if company == "Google" then  location = "アメリカの会社"
elsif company == "OCC" then  location = "沖縄の会社"
else                         location = "所在地不明"
end</code></pre>
                <p>さらに，then の代わりに :（コロン）を使えばさらに省略して書くことができる。</p>
                <em>※ : の後ろは半角スペースを空けること！</em>
                <pre><code>if company == "Google" :  location = "アメリカの会社"
elsif company == "OCC" :  location = "沖縄の会社"
else                      location = "所在地不明"
end</code></pre>
                <p>
                ここまで if 文と言わずに if 式という表現を用いてきたが，Ruby においては，if は式であり，値を返すので式という表現が当てはまる。<br />
                一番最後に実行された処理が値として返るので，変数 location に国名を入れるこれまでの処理は，以下のように書くことができる。
                </p>
                <pre><code>location = if company == "Google" : "アメリカの会社"
           elsif company == "OCC" : "沖縄の会社"
           else                     "所在地不明"
           end</code></pre>
                </li>

                <li>
                <h4>unless 式</h4>
                <p>
                if 式の逆で，条件式の演算結果が 偽（nil / false）の場合に実行される。<br />
                unless 式の場合，elsif は使用できない。 
                </p>
                <pre><code>unless 条件 then
  文
end</code></pre>
                <p>Java や C なら，!= を使う場面では，Ruby では unless を使うよう推奨されている。 </p>
                </li>

                <li>
                <h4>文修飾子</h4>
                <p>通常の文の最後に条件文を添えることができる。</p>
                <pre><code>puts "沖縄の会社です。" <strong>if company == "OCC"</strong></code></pre>
                <p>
                上記のように if 修飾子を用いた場合， if ～ の条件が真の場合だけ，その前の式が評価される。<br />
                unless 修飾子はその逆。
                </p>
                </li>

                <li>
                <h4>case 式</h4>
                <p>
                条件分岐ではある値を複数の値と比較したい場合もある。<br />
                if とelsif を使って一つ一つ比較していくことも出来るが，case 式を使うことで簡潔に記述する事が可能になる。
                </p>
                <pre><code>case 比較したいオブジェクト
when 値1 then
  処理1
when 値2 then
  処理2
when 値3 then
  処理3
else
  処理4
end</code></pre>
                <p>大きく分けて case 式の構文は次の2種類存在する。</p>
                <dl>
                    <dt>判断基準を最初に指定する場合</dt>
                    <dd>
                    <p>case 式の先頭に判断基準となるターゲットを指定し，when にはターゲットとの比較対象を書いていく。</p>
                    <pre><code>location = case company
           when "Google" : "アメリカの会社"
           when "OCC" then "沖縄の会社"
           else            "所在地不明"
           end</code></pre>
                    <em>※上記の例にあるように if 式と同じような使い方ができる。</em>
                    <p>case 式の結果を変数に代入したり，then キーワードや :（コロン）を用いて同一行に記述することが可能。</p>
                    </dd>
                    <dt>複数の条件を含ませる場合</dt>
                    <dd>
                    <p>
                    if ~ elsif が連続した場合とよく似ている。<br />
                    when 以降に条件式を書ける。
                    </p>
                    <pre><code>case
when company == "Google"
  location = "アメリカの会社"
when company == "OCC"
  location = "沖縄の会社"
else
  location = "所在地不明"
end</code></pre>
                    <p>
                    おまけ<br />
                    when 以降に複数の条件を指定することも可能。
                    </p>
                    <pre><code>location = case company
           when "Google", "Apple" : "アメリカの会社"
           <strong>when "OCC", "OCN"</strong>    : "沖縄の会社"
           else                     "所在地不明"
           end</code></pre>
                    </dd>
                </dl>
                </li>
                <li>
                <h4>よく使われる比較演算子</h4>
                <table>
                    <thead>
                        <tr>
                            <td>演算子</td>
                            <td>意味</td>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>==</th>
                            <td>等価性をテストする</td>
                        </tr>
                        <tr>
                            <th>===</th>
                            <td>case 文の when 節内で，各項目とターゲットの比較に使われる</td>
                        </tr>
                        <tr>
                            <th>&lt;=&gt;</th>
                            <td>汎用比較演算子。レシーバが引数より小さいとき -1，両者が等しいとき 0，レシーバが引数より大きいとき +1 を返す</td>
                        </tr>
                        <tr>
                            <th>&lt;, &lt;=, &gt;=, &gt;</th>
                            <td>より小さい，以下，以上，より大きい</td>
                        </tr>
                        <tr>
                            <th>=~</th>
                            <td>正規表現パターンマッチ</td>
                        </tr>
                        <tr>
                            <th>eql?</th>
                            <td>レシーバと引数の型と値が等しい時 true を返す</td>
                        </tr>
                    </tbody>
                </table>
                </li>
            </ol>
            </li>

            <li id="loop">
            <h3>ループ</h3>
            <ol>
                <li>
                <h4>基本的なループ</h4>
                <dl>
                    <dt>while</dt>
                    <dd>
                    <p>条件が真である限り，処理を繰り返し実行する。</p>
                    <pre><code>while 条件 do
  繰り返したい処理
end</code></pre>
                    <code>$ vi while.rb</code>

                    <pre><code>i = 1
while i &lt;= 5
  puts i
  i += 1
end</code></pre>
                    <code>$ ruby while.rb</code>
                    </dd>
                    <dt>until</dt>
                    <dd>
                    <p>while の逆。条件が偽である限り，処理を繰り返し実行する。</p>
                    <pre><code>until 条件 do
  繰り返したい処理
end</code></pre>
                    </dd>
                </dl>
                </li>

                <li>
                <h4>イテレータ</h4>
                <p>
                Ruby では while や for よりもイテレータを用いてループ構造を実装することが多い。<br />
                Ruby を学ぶ上でかなり重要な機能である。
                </p>
                <dl>
                    <dt>each</dt>
                    <dd>
                    <p>each はコレクション（オブジェクトの集まり）に対して、それを一つづつ取り出して処理を行うのに用いる。</p>
                    <pre><code>コレクション.each do |変数|
  繰り返したい処理
end</code></pre>
                    <p>コレクション（配列 or ハッシュ) の数だけ実行される。</p>
                    <p>配列の中身が 10 個の場合は 10 回ループする。</p>
                    <pre><code>collection = [ 1, 2, 3, 4, 5, 6, 7, 8, 9, 10 ]

collection.each do |x|
  puts x
end</code></pre>
                    </dd>
                    <dt>times</dt>
                    <dd>
                    <p>指定された回数だけループを実行する。</p>
                    <p>10 回繰り返す場合</p>
                    <pre><code>10.times do |x|
  # 繰り返したい処理
  print "#{x} "
end</code></pre>
                    </dd>
                    <dt>upto, downto, step</dt>
                    <dd>
                    <p>整数を一定範囲でループさせる場合に使う。 </p>
                    <p>10 回繰り返す場合</p>
                    <pre><code>1.upto(10) do |x|
  # 繰り返したい処理
  print "#{x} "
end</code></pre>
                    <p>0 から 12 まで 3ずつ増分させながら繰り返す場合</p>
                    <pre><code>0.step(12, 3) do |x|
  # 繰り返したい処理
  print "#{x} "
end</code></pre>
                    </dd>
                    <dt>loop</dt>
                    <dd>
                    <p>
                    無限にループする。<br />
                    ループを抜けるときは後に説明するループ制御構文等を用いる。
                    </p>
                    <pre><code>loop do
  繰り返したい処理
end</code></pre>
                    </dd>
                    <dt>for .. in</dt>
                    <dd>
                    <p>Ruby においての for 文は最初に紹介した each のシンタックスシュガーである。<br />
                    <em>※シンタックスシュガー（読みやすさのために導入された人間向けの文法。本質的な意味は変わらない。）</em>
                    </p>
                    <pre><code>for 変数 in コレクション
  繰り返したい処理
end</code></pre>
                    <p>↑ と ↓ は同じ意味である</p>
                    <pre><code>コレクション.each do |変数|
  繰り返したい処理
end</code></pre>
                    </dd>
                </dl>
                </li>

                <li>
                <h4>繰り返しの流れを変更する</h4>
                <p>ループ制御構文を用いると for while loop といった繰り返し文の途中で処理の流れを換えることがでる。</p>
                <dl>
                    <dt>break</dt>
                    <dd>
                    <p>繰り返しを終了させる break のサンプル（end 以降へジャンプする）</p>
                    <pre><code>for i in 1..10
  if (i == 7) then
    break #ジャンプ元
  end
  puts i
end #break のジャンプ先</code></pre>
                    </dd>
                    <dt>next</dt>
                    <dd>
                    <p>繰り返しを次ステップへ進める next のサンプル （条件式直前へジャンプする）</p>
                    <pre><code>for i in 1..10 # next のジャンプ先 (i in 1..10 のあたり)
  if (i == 7) then
    next #ジャンプ元
  end
  puts i
end</code></pre>
                    </dd>
                    <dt>redo</dt>
                    <dd>
                    <p>条件式を確認せずに繰り返しをやり直す redo のサンプル（条件式直後へジャンプする）</p>
                    <pre><code>for i in 1..10
  # redo のジャンプ先 (条件式の次行。よって、for の評価・加算や while の評価は行われない)
  printf(" _")
  if (i == 7) then
    redo #ジャンプ元
  end
  puts i
end</code></pre>
                    </dd>
                    <dt>retry</dt>
                    <dd>
                    <p>繰り返しを「再起動」してしまう retry のサンプル（評価のやりなおし）</p>
                    <pre><code>for i in 1..10 # retry のジャンプ先 (in 1..10 のカウンタが 1 にリセットされる!)
  if (i == 7) then
    retry #ジャンプ元
  end
  puts i
end</code></pre>
                    <em>※ break next redo retry の各キーワードは、if (条件) then break; end を break if (条件) のように記述することもできます。</em>
                    </dd>
                </dl>
                </li>
            </ol>
            </li>

            <li id="exercise">
            <h3>演習問題</h3>
            <h4>FizzBuzz 問題</h4>
            <ul>
                <li>1 から50までの数を順に数え，画面に表示させる。</li>
                <li>但し、その数が 3 で割り切れるならば数字の代わりに Fizz と、5 で割り切れるなら Buzz と表示させる。</li>
                <li>3 でも 5 でも割り切れる場合は、FizzBuzz の順に表示させる。</li>
            </ul>

            <code>$ vi fizzbuzz.rb</code>
            <p>頑張って実装してみよう</p>
            <em>ヒント：これまでに学んだものだけで作れるよ！</em>
            <ol>
                <li>演算子式</li>
                <li>条件式</li>
                <li>ループ </li>
            </ol>
            <p>実行結果</p>
            <code>$ ruby fizzbuzz.rb</code>
            <pre><samp>
1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
17
Fizz
19
Buzz
Fizz
22
23
Fizz
Buzz
26
Fizz
28
29
FizzBuzz
31
32
Fizz
34
Buzz
Fizz
37
38
Fizz
Buzz
41
Fizz
43
44
FizzBuzz
46
47
Fizz
49
Buzz
            </samp></pre>
            </li>
        </ol>
    </body>
</html>
